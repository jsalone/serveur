<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">


<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!-- 														HEAD 													-->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
 <head>
    <meta charset="utf-8">
    <title>PQCNP</title>
    <link rel="stylesheet" href="test2.css" />
  </head>



<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!-- 														BODY 												                                                      	-->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<body>
<!-- Ceci est un commentaire HTML -->

<audio id="audioPlayer" src="PQCNP"></audio>



<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!--                            PARTIE                                                                              -->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<fieldset id="part" class="container">
  <legend>Partie</legend>
        <fieldset  id="rp" class="item">
          <legend>Créer ou Rejoindre la partie</legend>
          <button id="rejoindrepartie">Rejoindre la partie</button>   
        </fieldset>
 <!--    
        <fieldset id="cp" class="item">
          <legend>Créer une partie</legend>
          <button id="creerpartie">Créer la partie</button>
        </fieldset>
-->
        <fieldset id="qp" class="item">
          <legend>Quitter la partie</legend>
          <button id="quitterpartie">Quitter la partie</button>
        </fieldset>
</fieldset>

<br>
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!--                            INFO GENERALE                                                                       -->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<fieldset>
  <legend>Info generale</legend>        
      <label>Jour: <input type='text' id="jour" readonly></label>
      <label>Heure: <input type='text' id="heure" readonly></label>
      <label>Meteo: <input type='text' id="meteo" readonly></label>
      <!--<label>Prevision Meteo: <input type='text' id="prevmeteo"readonly></label>-->
      <label>budget: <input type='text' id="budget" readonly></label>
</fieldset>

<br>

<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!--                            production                                                                          -->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<fieldset id="recet" class="container">
<legend>Production</legend>
<form id="elements">
<fieldset id="pb" class="item">
  <legend>Production boisson</legend>
     <!-- <label>Nombre recette: <input type='text' id="jour"></label>-->

          <br>
          <br>

                <SELECT name="recette1" size="1" id="SELECTrecette1">
                <option value="0">--NONE--</option>
                <option value="1">Limonade</option>
                <option value="2">Café</option>
                <option value="3">Soupe</option>
                <option value="4">Eau</option>
                </SELECT>
              
                <label>Nombre à produire: <input type='num' id="nbproduit1"></label>
                <label>Nombre vendu: <input type='num' id="venteproduit1"readonly></label>
             
          <br>
          <br>

                <SELECT name="recette2" size="1" id="SELECTrecette2">
                <option value="0">--NONE--</option>
                <option value="1">Limonade</option>
                <option value="2">Café</option>
                <option value="3">Soupe</option>
                <option value="4">Eau</option>
                </SELECT>
              
                <label>Nombre à produire: <input type='num' id="nbproduit2"></label>
                <label>Nombre vendu: <input type='num' id="venteproduit2"readonly></label>
           
          <br>
          <br>

                <SELECT name="recette3" size="1" id="SELECTrecette3">
                <option value="0">--NONE--</option>
                <option value="1">Limonade</option>
                <option value="2">Café</option>
                <option value="3">Soupe</option>
                <option value="4">Eau</option>
                </SELECT>
              
                <label>Nombre à produire: <input type='num' id="nbproduit3"></label>
                <label>Nombre vendu: <input type='num' id="venteproduit3"readonly></label>


          <br>
          <br>

                <SELECT name="recette4" size="1" id="SELECTrecette4">
                <option value="0">--NONE--</option>
                <option value="1">Limonade</option>
                <option value="2">Café</option>
                <option value="3">Soupe</option>
                <option value="4">Eau</option>
                </SELECT>
              
                <label>Nombre à produire: <input type='num' id="nbproduit4"></label>
                <label>Nombre vendu: <input type='num' id="venteproduit4"readonly></label>


          <br>
          <br>
          <label>Cout total <input type='num' id="coutt"></label>

</fieldset>

<fieldset id="cb" class="item">
  <legend>Cout boisson</legend>
            <label>Limonade: <input type='num' id="limo"readonly></label>
            <br>
            <label>Cafe: <input type='num' id="cafe"readonly></label>
            <br>
            <label>Soupe: <input type='num' id="soupe"readonly></label>
            <br>
            <label>Eau: <input type='num' id="eau"readonly></label>
</fieldset>
</form>
<button id="valider">validé et envoyer</button>


<fieldset id="listi" class="item">
  <legend>Liste ingrédients</legend>
      <ul id="listeingredients"></ul>
</fieldset>

</fieldset>



<br>


<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!--                            Position                                                                            -->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->

<fieldset>
<legend>Position</legend>
<fieldset>
 <form id="from_joueur">
  <legend>Mini carte</legend>
      

      <img src="map.jpg"alt="map"/>


      <br>
      <label>Nom du joueur: <input type='text' id="champ_joueur"readonly></label>
      <legend>Position Joueur</legend>
      <label>X: <input type='num' id="xjoueur" readonly></label>
      <label>Y: <input type='num' id="yjoueur" readonly></label>
      </form>
</fieldset>



<fieldset>
  <legend>Panneau publicitaire</legend>
    <label>Achat de panneau: <input type='num' id="nbpanneau"></label>
    <ul id="listepanneau"></ul>
    <br>
</fieldset>
</fieldset>

<button id="refresh">Rafraichir</button>

<button id="rinit">Réinitialisé</button>
</body>




<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!--                            SCRIPT                                                                              -->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
<script >
/**************************************************************************************************************************************************/
/*                                                              action jour suivant                                                               */
/**************************************************************************************************************************************************/

        $("#valider").click(function(event) {
          event.preventDefault();

            var  data1={
            "SELECTrecette1": $("#SELECTrecette1").val(),
            "SELECTrecette2": $("#SELECTrecette2").val(),
            "SELECTrecette3": $("#SELECTrecette3").val(),
            "SELECTrecette4": $("#SELECTrecette4").val()
            }
            
            var data2={
            "nbproduit1": $("#nbproduit1").val(),
            "nbproduit2": $("#nbproduit2").val(),
            "nbproduit3": $("#nbproduit3").val(),
            "nbproduit4": $("#nbproduit4").val()
            }

            var data3={
            "joueur": $("#joueur").val(),
            "data1": $(data1).val(),
            "data2": $(data2).val(),
            "panneau": $("#nbpanneau").val()
            }

            var dataJason =JSON.stringify(data3)
            //requete pour l'envoie de donnée
            $.ajax("https://enigmatic-bayou-14181.herokuapp.com/actions/#joueur", {
            'type': "POST",
            'data': JSON.stringify(data3),// decompresse la donnée en string pour python
            'contentType': "application/json",
            })

            var i=1;
            for (i=0;i<$("#nbpanneau").val();i++){
            var text = val(response['Plocation']['longitude'])
            var text2 = val(response['Plocation']['latitude'])
            $('#listepanneau').append('<li>' + text + text2 + '</li>');
            }
            $("#coutt").val(response['info']['cout'])

        })
          

/**************************************************************************************************************************************************/
/*                                                              rejoindrepartie                                                                   */
/**************************************************************************************************************************************************/

        $("#rejoindrepartie").click(function(event) {

            var saisie = prompt("Saisissez votre pseudo :", "")


            $.ajax("https://enigmatic-bayou-14181.herokuapp.com/prixboisson").then(function(num) {
            $("#limo").val(response['limonade'])
            $("#cafe").val(response['cafe'])
            $("#soupe").val(response['soupe'])
            $("#eau").val(response['eau'])
            })

            $.ajax("https://enigmatic-bayou-14181.herokuapp.com/players", {
            'type': "POST",
            'data': JSON.stringify({'name':saisie}),// decompresse la donnée en string pour python
            'contentType': "application/json",
            }).fail(function(response) {
	          $("#error").text(response.responseJSON["error"])
	          }).done(function(response) {
	          alert(JSON.stringify(response));

            $("#champ_joueur").val(response['name'])
	          $("#xjoueur").val(response['location']['longitude'])
	          $("#yjoueur").val(response['location']['latitude'])
	          $("#budget").val(response['info']['cash'])

            

	          })
        })

/**************************************************************************************************************************************************/
/*                                                              reset                                                                             */
/**************************************************************************************************************************************************/

      $("#reset").click(function(event) {
            $.ajax("https://enigmatic-bayou-14181.herokuapp.com/reset")   
            alert(event); 
      })


/**************************************************************************************************************************************************/
/*                                                              quitterpartie                                                                     */
/**************************************************************************************************************************************************/

      $("#quitterpartie").click(function(event) {
        $.ajax("https://enigmatic-bayou-14181.herokuapp.com/players/#joueur", {
            'type': "DELETE",
            'contentType': "application/json"
        }) 
      	alert(event);
      })

/**************************************************************************************************************************************************/
/*                                                              refreshAction    (metrologie)                                                     */
/**************************************************************************************************************************************************/

      function refreshAction(event) {
            if (event) event.preventDefault();
            $.ajax("https://enigmatic-bayou-14181.herokuapp.com/metrology").then(function(text) {
            $("#meteo").val(response['meteo'])
            $("#jour").val(response['jour'])
            $("#heur").val(response['heur'])
            })
            ingredientsAction();
          }

      $("#refresh").click(refreshAction)

      var sec=12500;
      setInterval(refreshAction,sec);
      refreshAction(false)

/**************************************************************************************************************************************************/
/*                                                              ingredients                                                                     */
/**************************************************************************************************************************************************/
    function ingredientsAction(event) {
            if (event) event.preventDefault();
            $.ajax("https://enigmatic-bayou-14181.herokuapp.com/ingredient").then(function(text) {
            var i=1;
            var fin = val(response['nbingredients'])
            for (i=0;i<fin;i++){
            var text = val(response['ingredient'])
            $('#listeingredients').append('<li>' + text + '</li>');
            }
            })

          }


          

</script>



</html>